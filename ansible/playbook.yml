---
- name: Bootstrap a Fedora development host
  hosts: all
  become: yes
  vars_files:
    - pkglists/fedora.yml
  tasks:
    - name: Print ansible_virtualization_type
      ansible.builtin.debug:
        var: ansible_virtualization_type

    - name: Install all packages
      ansible.builtin.dnf:
        name: "{{ cli_pkgs + gui_pkgs + kernel_dev_pkgs }}"
        install_weak_deps: false
        update_cache: true
        state: latest

    - name: Create development user
      ansible.builtin.user:
        name: "{{ dev_user.login }}"
        comment: "{{ dev_user.name }}"
        groups: "{{ dev_user.groups }}"
        append: yes
        shell: "{{ dev_user.shell }}"
        create_home: yes
        generate_ssh_key: yes
        ssh_key_type: "{{ dev_user.ssh_key_type }}"
        ssh_key_comment: "{{ dev_user.ssh_key_comment }}"
        state: present

    - name: Install custom /etc/wsl.conf
      ansible.builtin.copy:
        src: files/wsl.conf
        dest: /etc/wsl.conf
        owner: root
        group: root
        mode: '0644'
        force: true
        backup: true
      # when:
      #   # FIME: this isn't working on my F43 container, a_v_type is
      #   # "container" when running the playbook, even though ansible
      #   # -m setup shows "wsl".
      #   - ansible_virtualization_type is defined
      #   - ansible_virtualization_type == "wsl"
